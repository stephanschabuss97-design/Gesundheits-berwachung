

/* ANKER: chart-controls styles (move to assets/app.css bei naechster Release) */
  /* Dropdown optisch kompakter */
  #chart .controls .compact { max-width: 240px; }

  /* KPI-Zeile: -Werte neben dem Dropdown */
  #chart .controls .kpis {
    display: inline-flex;
    gap: 16px;
    align-items: center;
    margin-left: 16px;
    color: var(--text, #e5e7eb);
    font-size: 0.95rem;
    white-space: nowrap;
  }
  #chart .controls .kpis .sep { opacity: .6; }
  
  outline:none;
  border-color:var(--color-accent);
  box-shadow:0 0 0 2px rgba(58,61,255,0.25);
}
textarea{min-height:64px;resize:vertical}

.small{font-size:12px;color:var(--color-text-muted)}
.btn{
  appearance:none;
  border:none;
  border-radius:8px;
  padding:0 18px;
  height:40px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  font-size:1rem;
  letter-spacing:0.2px;
  color:var(--color-text-primary);
  background:rgba(43,47,58,0.92);
  cursor:pointer;
  touch-action:manipulation;
  transition:background .2s ease, color .2s ease, transform .1s ease, box-shadow .2s ease;
}
.btn:disabled{
  opacity:.6;
  cursor:not-allowed;
}
.btn:focus-visible{
  outline:none;
  box-shadow:0 0 0 2px rgba(58,61,255,0.3);
}
.btn:not(:disabled):hover{
  filter:brightness(1.08);
}
.btn:not(:disabled):active{
  transform:scale(0.98);
}
.btn.primary{
  background:rgba(58,61,255,0.85);
  color:#fff;
  box-shadow:0 8px 20px rgba(58,61,255,0.18);
}
.btn.primary:focus-visible{
  box-shadow:0 0 0 3px rgba(58,61,255,0.3), 0 8px 20px rgba(58,61,255,0.18);
}
.btn.primary:not(:disabled):hover{
  filter:brightness(1.06);
}
.btn.ghost{
  background:rgba(43,47,58,0.35);
  border:1px solid var(--color-border-subtle);
  color:var(--color-text-primary);
}
.btn.ghost:not(:disabled):hover{
  background:rgba(255,255,255,0.05);
}
.btn.warn{
  background:var(--color-warn);
  color:#121417;
}
.btn.warn:not(:disabled):hover{
  filter:brightness(1.05);
}
.btn.toggle{
  border:1px solid var(--color-border-subtle);
  background:var(--color-surface-elevated);
  color:var(--color-text-primary);
}
.btn.toggle.active{
  background:var(--color-success);
  border-color:rgba(46,204,113,0.4);
  color:#062615;
}
/* Tabs: aktiver Zustand = wie Primary */
nav.tabs .btn{
  height:40px;
  padding:0 16px;
  border-radius:8px;
  background:transparent;
  border:1px solid transparent;
  color:var(--color-text-muted);
  position:relative;
  transition:color .2s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
}
nav.tabs .btn:not(.primary):hover{
  color:var(--color-text-primary);
  border-color:var(--color-border-subtle);
  background:var(--color-surface-elevated);
}
nav.tabs .btn:focus-visible{
  outline:none;
  box-shadow:0 0 0 2px rgba(58,61,255,0.25);
}
nav.tabs .btn.primary {
  color:#fff;
  background:rgba(58,61,255,0.2);
  border-color:rgba(58,61,255,0.35);
  box-shadow:0 10px 25px rgba(58,61,255,0.18);
}
nav.tabs .btn.primary::after{
  content:"";
  position:absolute;
  left:12px;
  right:12px;
  bottom:-6px;
  height:2px;
  border-radius:999px;
  background:var(--color-accent);
  box-shadow:0 4px 12px rgba(58,61,255,0.35);
}
.btn.flash{
  background:linear-gradient(90deg,var(--color-accent) 0%,#7c3aed 50%,var(--color-accent) 100%)!important;
  background-size:200% 100%;
  color:#fff!important;
  animation:flashGradient 1s ease forwards,flashPop .2s ease;
  box-shadow:0 6px 24px rgba(79,70,229,.35);
  border-radius:8px;
  height:40px;
}
@keyframes flashGradient{0%{background-position:0% 50%}100%{background-position:100% 50%}}
@keyframes flashPop {
0% { transform: scale(1) }
50% { transform: scale(1.03) }
100% { transform: scale(1) }
}


.spacer{flex:1}
section.view{display:none}
section.view.active{display:block}


#err{position:fixed;left:8px;right:8px;bottom:8px;background:#3d0d0d;color:#fecaca;padding:8px 10px;border-radius:10px;display:none;z-index:9999}

/* Panels */
.panel{position:fixed;right:8px;bottom:8px;max-height:80vh;overflow:auto;background:#0f1116;border:1px solid #2b2f3a;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.35);display:none;z-index:9998}
/* Panel (Charts) - Fullscreen */
.panel.chart{
  inset: 0;                 /* volle Flaeche (top/right/bottom/left = 0) */
  width: 100vw;
  height: 100dvh;           /* korrekt auf Mobile (sichtbare Hoehe) */
  max-width: 100vw;
  max-height: 100dvh;
  border-radius: 0;         /* keine abgerundeten Ecken im Vollbild */
}

/* Flex-Layout: Header fix oben, Inhalt fuellt Rest */
.panel.chart{
  /* Sichtbarkeit steuert JS; NICHT auf block setzen */
}
.panel.chart header{ 
  /* bleibt oben, keine Aenderung noetig - aber fixere Hoehe ist hilfreich */
  min-height: 44px;
}
.panel.chart .content{
  /* Inhalt fuellt den verfuegbaren Raum */
  height: calc(100dvh - 44px - 2px); /* 44px Header + 1px border oben/unten */
  display: flex;
  flex-direction: column;
  overflow: auto;
}
.panel header{display:flex;gap:6px;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #2b2f3a}
.panel h4{margin:0;font-size:14px}
.panel .content{
  padding: 12px;
  font-size: 13px;
  line-height: 1.45;
}
#diag pre{margin:0;padding:8px;font-size:12px;white-space:pre-wrap}

/* FABs */
.fab-wrap{position:fixed;right:8px;bottom:8px;display:flex;flex-direction:column;gap:8px;z-index:9999}
.fab{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:1px solid #2b2f3a;background:#0f1116;cursor:pointer}
.fab:hover{box-shadow:0 8px 24px rgba(0,0,0,.35)}

/* Chart panel */
#chart .controls{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
  margin-bottom:6px;
}
#chart .controls select{
  appearance:none;
  background:var(--color-surface-elevated);
  border:1px solid var(--color-border-subtle);
  border-radius:8px;
  padding:0 14px;
  height:40px;
  color:var(--color-text-primary);
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
#chart .controls select:focus-visible{
  outline:none;
  border-color:var(--color-accent);
  box-shadow:0 0 0 2px rgba(58,61,255,0.25);
}
#chart .controls .kpis{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:8px 12px;
  border-radius:8px;
  background:var(--color-surface-elevated);
  border:1px solid var(--color-border-subtle);
  color:var(--color-text-primary);
  box-shadow:0 8px 22px rgba(0,0,0,0.2);
}
#chart .controls .kpis .sep{
  opacity:.6;
  color:var(--color-text-muted);
}
/* ANKER: flags-overlay CSS */
#chartSvg .flags { pointer-events: auto; }
#chart .controls > * {flex:1}
#chart .controls .half{flex:0 0 calc(50% - 4px)}
  
  /* SVG fuellt verbleibende Hoehe vollstaendig */
#chart svg{
  flex: 1 1 auto;
  width: 100%;
  height: 100%;     /* statt auto */
  min-height: 160px;
  display: block;
  background: radial-gradient(circle at top, rgba(255,255,255,0.045), transparent 55%);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 10px;
}

#chartSvg{
  transform-origin:center;
}
#chartSvg.chart-refresh{
  animation:chartRescale .48s cubic-bezier(.25,.1,.25,1);
}
@keyframes chartRescale{
  0%{opacity:0.35; transform:translateY(8px);}
  100%{opacity:1; transform:translateY(0);}
}

#chart .legend{display:flex;gap:10px;font-size:12px;color:var(--color-text-muted);margin-top:6px;flex-wrap:wrap}

.dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px;border:1px solid rgba(0,0,0,0.3)}

#chartSvg path[data-series]{
  transition: opacity .2s ease, stroke-width .18s ease, filter .18s ease;
  stroke-linecap:round;
}
#chartSvg path[data-series].is-hover{ stroke-width:2.8; opacity:1; filter:brightness(1.12); }
#chartSvg path[data-series].is-dim{ opacity:.25; }

#chartSvg .pt{
  transform-box: fill-box;
  transform-origin: center;
  transition: transform .18s cubic-bezier(.16,1,.3,1), opacity .18s cubic-bezier(.16,1,.3,1), filter .18s ease;
}
#chartSvg .pt.is-hover{ transform:scale(1.4); opacity:1; filter:brightness(1.08); }
#chartSvg .pt.is-dim{ opacity:.35; }

#chartSvg .body-bar{
  transition: opacity .18s cubic-bezier(.16,1,.3,1), transform .18s cubic-bezier(.16,1,.3,1);
  transform-box: fill-box;
  transform-origin: center;
}
#chartSvg .body-bar.is-hover{ opacity:.9; transform:translateY(-1px); }
#chartSvg .body-bar.is-dim{ opacity:.35; }

#chart .legend [data-series]{
  transition: opacity .18s cubic-bezier(.16,1,.3,1), transform .18s cubic-bezier(.16,1,.3,1);
}
#chart .legend [data-series].is-hover{ opacity:1; transform:translateY(-1px); }
#chart .legend [data-series].is-dim{ opacity:.35; }

#chartSvg .goal-band{
  fill:var(--color-chart-goal-sys);
  stroke:none;
}
#chartSvg .goal-band.goal-dia{
  fill:var(--color-chart-goal-dia);
}
.chart-tip{
  position:absolute;
  inset:auto auto auto auto;
  transform:translate(8px,8px);
  background:var(--color-chart-tooltip-bg);
  border:1px solid rgba(60,68,90,.65);
  border-radius:8px;
  padding:8px 10px;
  font-size:12px;
  line-height:1.35;
  max-width:280px;
  box-shadow:0 12px 28px rgba(0,0,0,.42);
  color:var(--color-text-primary);
  text-shadow:0 1px 1px rgba(0,0,0,.35);
  pointer-events:none;
  opacity:0;
  transition:opacity .15s ease;
  display:block;
  z-index:2;
}

#chartSvg .chart-hit{ cursor:pointer; }
#chartSvg .chart-hit:focus-visible{ outline:2px solid var(--color-accent); outline-offset:2px; }

/* Busy overlay */
#busy{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);z-index:99998}
#busy .box{background:#10131a;border:1px solid #2b2f3a;border-radius:12px;padding:12px 16px;font-weight:600}

.seg{display:flex;gap:8px;margin:8px 0 12px}
.seg .seg-btn.active{background:var(--color-accent);color:#fff}
.hidden{display:none!important}
:focus-visible{ outline:2px solid var(--color-accent); outline-offset:2px; }

/* App-Lock Overlay */
#appLock{
  position: fixed; inset: 0; z-index: 10001;
  display: none; align-items: center; justify-content: center;
  background: rgba(0,0,0,.45); backdrop-filter: blur(2px);
}
#appLock .lock-card{
  width: min(420px, 92vw);
  background: #fff; color: #111;
  border-radius: 16px; padding: 18px;
  box-shadow: 0 18px 48px rgba(0,0,0,.35);
  border: 1px solid #e5e7eb;
}
#appLock .lock-card h3{ margin: 0 0 6px; }
#appLock .btn.primary{ background: var(--color-accent); color: #fff; }
#appLock .pin-wrap{ display:flex; gap:8px; margin-top:8px; }
#appLock .pin-wrap input{
  flex:1; background:#f8fafc; color:#111; border:1px solid #e5e7eb;
}

/* Body-State: solange gelockt ist, Interaktion sperren (Overlay deckt ohnehin ab) */
body.app-locked main, body.app-locked nav, body.app-locked header{
  filter: blur(0); /* bewusst ohne Blur, nur visuelles Dimmen optional */
}
body.app-locked { pointer-events: auto; } /* Overlay nimmt Events ab */

/* Login-Overlay */
#loginOverlay{

  position: fixed; inset: 0; z-index: 10000;
  display: none; align-items: center; justify-content: center;
  background: rgba(0,0,0,.35); backdrop-filter: blur(2px);
}
#loginOverlay .login-card{
  width: min(420px, 92vw);
  background: #fff; color: #111;
  border-radius: 16px; padding: 18px;
  box-shadow: 0 18px 48px rgba(0,0,0,.35);
  border: 1px solid #e5e7eb;
}
#loginOverlay .login-card h3{ margin: 0 0 6px; }
  #loginOverlay .btn.primary{ background: var(--color-accent); color: #fff; }
  
/* --- SAFETY: versteckte Dinge fangen keine Klicks --- */
[hidden] {
  display: none !important;
  pointer-events: none !important;
}

/* Versteckte Overlays fangen niemals Pointer-Events */
#loginOverlay[hidden],
#appLock[hidden],
#loginOverlay.is-hidden,
#appLock.is-hidden {
  display: none !important;
  pointer-events: none !important;
}

/* --- SAFETY: summary darf nie full-screen 'oben' liegen --- */
summary {
  position: static !important;
  z-index: auto !important;
  pointer-events: auto !important;
}
details[open] > summary {
  position: static !important;
}

/* Falls Details per hidden versteckt werden */
details[hidden] {
  display: none !important;
  pointer-events: none !important;
}

/* Optional: Config-Accordion im Login-Overlay explizit entschaerfen */
#configAdv > summary { position: static !important; }


/* Inline style replacements */
[data-style="row-flex-center-gap8"] { align-items:center; gap:8px; flex-wrap:wrap; margin-top:0; }
[data-style="row-flex-end-gap12"] { align-items:flex-end; gap:12px; flex-wrap:wrap; }
[data-style="row-flex-end-gap8"] { align-items:flex-end; gap:8px; flex-wrap:wrap; }
[data-style="row-flex-end-gap8-mt12"] { align-items:flex-end; gap:8px; flex-wrap:wrap; margin-top:12px; }
[data-style="config-summary"] { cursor:pointer; list-style:none; padding:8px 0; }
[data-style="block-mb6"] { display:block; margin-bottom:6px; }
[data-style="flex-center-gap10"] { display:flex; align-items:center; gap:10px; }
[data-style="flex-col-gap6-mt4"] { display:flex; flex-direction:column; gap:6px; margin-top:4px; }
[data-style="u-hidden"] { display:none; }
[data-style="diag-log"] { display:none; position:fixed; bottom:0; left:0; right:0; max-height:40vh; overflow:auto; background:#111; color:#eee; font-size:12px; padding:4px; z-index:10000; }
[data-style="flex-fixed-220"] { flex:0 0 220px; }
[data-style="flex-grow-min180"] { flex:1; min-width:180px; }
[data-style="gap-8"] { gap:8px; }
[data-style="m-0"] { margin:0; }
[data-style="mb-8"] { margin:0 0 8px; }
[data-style="mb10-opacity80"] { margin-bottom:10px; opacity:.8; }
[data-style="mb-12"] { margin-bottom:12px; }
[data-style="mb12-opacity80"] { margin-bottom:12px; opacity:.8; }
[data-style="mt10-opacity75"] { margin-top:10px; opacity:.75; }
[data-style="mt-4"] { margin-top:4px; }
[data-style="mt-6"] { margin-top:6px; }
[data-style="mt6-muted"] { margin-top:6px; color:#6b7280; }
[data-style="mt8-opacity80"] { margin-top:8px; opacity:.8; }
[data-style="status-muted"] { min-height:16px; color:#9aa3af; }
[data-style="minw-180"] { min-width:180px; }
[data-style="opacity-70"] { opacity:.7; }
[data-style="opacity70-mt6"] { opacity:.7; margin-top:6px; }
[data-style="flex-wrap-gap8-opacity80"] { opacity:.8; display:flex; gap:8px; flex-wrap:wrap; }
[data-style="overflow-auto"] { overflow:auto; }
[data-style="text-center-mt6"] { text-align:center; margin-top:6px; }
[data-style="w100-h48"] { width:100%; height:48px; }
[data-style="w100-h48-mb12"] { width:100%; height:48px; margin-bottom:12px; }
[data-style="w100-mt4"] { width:100%; margin-top:4px; }
[data-style="w100-mt6"] { width:100%; margin-top:6px; }
[data-style="w100-mt8"] { width:100%; margin-top:8px; }
[data-style="input-field"] { width:100%; padding:10px; border-radius:8px; border:1px solid #d1d5db; }
[data-style="textarea-field"] { width:100%; padding:10px; border-radius:8px; border:1px solid #d1d5db; resize:vertical; }
[data-style="w-140"] { width:140px; }
[data-style="w-auto"] { width:auto; }
.chart-tip-header { opacity:.85; margin-bottom:4px; }
.chart-tip-note { white-space:pre-wrap; margin-bottom:0; }
.chart-tip-note--with-flags { margin-bottom:6px; }
.chart-tip-flags { margin-top:2px; }
.chart-tip-flags--tight { margin-top:0; }
.chart-tip-flags-list { margin:4px 0 0 16px; padding:0; }

